<!-- 
############################################
#화면명 : design-module-board-boardDetail.jsp 
#(상담형 게시판 상세 화면 : 홈페이지) 
# 갱신 : 2019.07.02 암호회 
############################################
-->
<script>
function encode64(str){
	return encode(escape(str));
}

var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
	
function encode(input){
	var output = ""
	var chr1, chr2, chr3;
	var enc1, enc2, enc3, enc4;
	var i =0;
	do{
			chr1 = input.charCodeAt(i++);
			chr2 = input.charCodeAt(i++);
			chr3 = input.charCodeAt(i++);
			enc1 = chr1 >> 2;
			enc2 = ((chr1 & 3) << 4) | (chr2 >> 4 );
			enc3 = ((chr2 & 15) << 2) | (chr3 >> 6 );
			enc4 = chr3 & 63;
			if(isNaN(chr2)){
				enc3 = enc4 =64;
			}else if(isNaN(chr3)){
				enc4 = 64;
			}
			output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);
	}while(i<input.length);
	
	return output;
	}
</script>
<script type="text/javascript">
	var fileObjArray = new Array();

	$("#list_btn").click(function(){
		
		$.ajax({
			type:'POST'
			, url:'/dggb/module/board/selectBoardListAjax.do'
			, cache : false
			, async : false
			, data:$("#boardFrm").serialize()
			, success:function (data) {
				$('#board_area').html(data);
			}
			, error:function (data) {
			    alert('오류');
			}
      	});
	});
		
	$("#reply_btn").click(function(){
		
		$.ajax({
			type:'POST'
			, url:'/dggb/module/board/replyBoardPageAjax.do'
			, cache : false
			, async : false
			, data:$("#boardFrm").serialize()
			, success:function (data) {
				$('#board_area').html(data);
			}
			, error:function (data) {
			    alert('오류');
			}
      	});
	});
		
	$("#delete_btn").click(function(){
		
		if(!confirm('삭제하시겠습니까?')){
			return;
		}
		
		$.ajax({
			type:'POST'
			, url:'/dggb/module/board/deleteBoardAjax.do'
			, cache : false
			, async : false
			, data:$("#boardFrm").serialize()
			, success:function (data) {
				$('#board_area').html(data);
			}
			, error:function (data) {
			    alert('오류');
			}
      	});
	});
	
	$("#modify_btn").click(function(){
		
		//kyc 암복호
		var nttId = $("#nttId").val();
		var ifNttId = encode64(nttId);
		$('input[name=ifNttId]').val(ifNttId);
		//
		
		$.ajax({
			type:'POST'
			, url:'/dggb/module/board/modifyBoardPageAjax.do'
			, cache : false
			, async : false
			, data:$("#boardFrm").serialize()
			, success:function (data) {
				$('#board_area').html(data);
			}
			, error:function (data) {
			    alert('오류');
			}
      	});
	});

</script>
<!-- //kyc 2019 암복호 -->
<input id="ifNttId" name="ifNttId" type="hidden"/>
<!-- // -->
<input id="nttId" name="nttId" type="hidden" value="21540998"/>
<input id="sortOrdr" name="sortOrdr" type="hidden" value="1"/>
<table class="board_type01_tb_readform" summary="이표는 이름, 등록일, 제목, 내용, 파일첨부로 구성되어 있습니다.">
<caption>공지사항 게시판 상세보기</caption>
<colgroup>
<col width="10%"/>
<col width="40%"/>
<col width="10%"/>
<col width="40%"/>
</colgroup>
<tbody>
<tr>
<th scope="row">이름</th>
<td>
<div>
					
					한상미
				</div>
</td>
<th class="mid" scope="row">등록일</th>
<td>
<div>2021-09-10</div>
</td>
</tr>
<tr>
<th scope="row">제목</th>
<td colspan="3">
<div>중학교 입학전 예방접종 안내</div>
</td>
</tr>
<!-- 		
		
		<tr>
			<th scope="row">공지설정</th>
			<td colspan="3">
				<div>
					
					공지사용안함 (X)
				</div>
			</td>
		</tr>
		
 -->
<tr>
<th scope="row">내용</th>
<td colspan="3">
<div class="content">
<p>
<p>중학교 입학전 예방접종 안내해드립니다</p>
</p>
</div>
</td>
</tr>
<script type="text/javascript">
	var serverFileObjArray = new Array();
	var updateFlag = "N";
	
	$(function(){
		var uploader = $("#multiFileUploader");
		
		
			var serverFileObj = new Object();
			
			serverFileObj["name"] = "중학교 입학전 예방접종 안내.pdf";
			serverFileObj["size"] = "2273459";
			serverFileObj["atchFileId"] = "FILE_000000009422712";
			serverFileObj["fileSn"] = "0";
			
			serverFileObjArray.push(serverFileObj);
		
		
		setTimeout(function(){reflashFileInfoList();}, 200);

		$("#uploadBtn").bind("click", function(){
			uploader.trigger("click");
		});
		
		uploader.bind("change", function(){
			var fileList = this.files;
			var fileCount = $("#fileListTable").find("tbody").find("tr").length;
			var maxUploadCount = Number("2");
			
			for(var fileIndex in fileList){
				if(Object.prototype.toString.call(fileList[fileIndex]) === "[object File]"){
					if(fileCount < maxUploadCount){
						// fileObjArray.push(fileList[fileIndex]); 기존 위치 2018.05.28  
						
						if(fnMaxFileSize(fileList[fileIndex], "notice")){
							fileObjArray.push(fileList[fileIndex]); // 위치변경 2018.05.28 임근기
							addFileInfoList(fileList[fileIndex]);
							fileCount++;
						}
					}
					else{
						alert("첨부파일은 최대 2까지 업로드 가능합니다.");
						break;
					}
				}
			}
			
			$(this).val("");
		});
	});
	
	function reflashFileInfoList(){
		$("#fileListTable").find("tbody").children("*").remove();
		$("#multiFileUploader").parent().find("input[name^=file_]").remove();

		for(var index in serverFileObjArray){
			var serverFileObj = serverFileObjArray[index];
			
			if(Object.prototype.toString.call(serverFileObj.atchFileId) != "[object Undefined]" && serverFileObj.atchFileId != null && serverFileObj.atchFileId != ""){
				addFileInfoList(serverFileObj);
			}
		}
		
		for(var index in fileObjArray){
			if(fnMaxFileSize(addFileInfoList(fileObjArray[index]), "notice")){
				addFileInfoList(fileObjArray[index]);
			}
		}
	}
	
	function addFileInfoList(fileObj){
		var uploader = $("#multiFileUploader");
		var tbodyElement = $("#fileListTable").find("tbody");
		var index = tbodyElement.find("tr").length;
		var trElement = $("<tr />");
		var fileNameExt = fileObj.name.split(".");
		var fileName = null;
		var fileExt = fileNameExt[fileNameExt.length-1].toUpperCase();
		var fileSize = Math.round(fileObj.size/1024/1024 * 100)/100;
		var spanElement = $("<span />");
		var spanElement2 = $("<span />");
		
		var hrefElement = $("<a />");
		var hrefElement2 = $("<a />");

		for(var i=0; i<(fileNameExt.length-1); i++){
			fileName = fileName==null?fileNameExt[i]:fileName+"."+fileNameExt[i];
		}

		
		trElement.append($("<td />").text(++index)).append($("<td />").text(fileName)).append($("<td />").text(fileExt)).append($("<td />").text(fileSize+"MB")).append($("<td />").append(hrefElement).append("&nbsp;").append(hrefElement2));
		

		if(updateFlag != "Y" && Object.prototype.toString.call(fileObj.atchFileId) === "[object Undefined]"){
			spanElement.addClass("btn_up").bind("click", function(){
				alert("업로드 대기 중인 파일입니다.\n수정 버튼을 클릭하여 파일을 업로드 해 주세요.");
			}).text("업로드 대기 중");

			//trElement.append($("<td />").append(spanElement));
		}

		else{
			hrefElement.attr({"href": "#file"+(updateFlag=="Y"?"Delete":"Down"), "title": fileName+(updateFlag=="Y"?" 파일삭제":" 다운로드")}).addClass(updateFlag=="Y"?"btn_del":"btn_down").bind("click", function(){
				var trElement = $(this).parent().parent();
				var currentIndex = Number(trElement.find("td:eq(0)").text())-1;

				if(updateFlag == "Y"){
					if(currentIndex < serverFileObjArray.length){
						deleteFileObjArray.push(serverFileObjArray[currentIndex]);
						serverFileObjArray.splice(currentIndex, 1);
					}
					else{
						fileObjArray.splice((currentIndex-serverFileObjArray.length), 1);
					}
					
					reflashFileInfoList();
				}
				else{
					if(currentIndex < serverFileObjArray.length){
						var currentFileObj = serverFileObjArray[currentIndex];
							fn_egov_downFile(currentFileObj.atchFileId, currentFileObj.fileSn);
					}
				}

			}).text(updateFlag=="Y"?"파일삭제":"다운로드");
			
			hrefElement2.attr({"href": "#file"+(updateFlag=="Y"?"":"btn_down2"), "title": fileName+(updateFlag=="Y"?"":" 미리보기")}).addClass(updateFlag=="Y"?"":"btn_down2").bind("click", function(){
				var trElement = $(this).parent().parent();
				var currentIndex = Number(trElement.find("td:eq(0)").text())-1; 
				if(updateFlag == "Y"){
					if(currentIndex < serverFileObjArray.length){
						deleteFileObjArray.push(serverFileObjArray[currentIndex]);
						serverFileObjArray.splice(currentIndex, 1);
					}
					else{
						fileObjArray.splice((currentIndex-serverFileObjArray.length), 1);
					}
					
					reflashFileInfoList();
				}
				else{
					if(currentIndex < serverFileObjArray.length){
						var currentFileObj = serverFileObjArray[currentIndex];
						
						fn_cnvrFileDown(currentFileObj.atchFileId, currentFileObj.fileSn);
					}
				}
			}).text(updateFlag=="Y"?"":"미리보기");
			
		}		
		

/*
		if(updateFlag != "Y" && Object.prototype.toString.call(fileObj.atchFileId) === "[object Undefined]"){
			spanElement.addClass("btn_up").bind("click", function(){
				alert("업로드 대기 중인 파일입니다.\n수정 버튼을 클릭하여 파일을 업로드 해 주세요.");
			}).text("업로드");
		}
		else{
			spanElement.addClass(updateFlag=="Y"?"btn_del":"btn_down").bind("click", function(){
				var trElement = $(this).parent().parent();
				var currentIndex = Number(trElement.find("td:eq(0)").text())-1;
		
				if(updateFlag == "Y"){
					if(currentIndex < serverFileObjArray.length){
						deleteFileObjArray.push(serverFileObjArray[currentIndex]);
						serverFileObjArray.splice(currentIndex, 1);
					}
					else{
						fileObjArray.splice((currentIndex-serverFileObjArray.length), 1);
					}
					
					reflashFileInfoList();
				}
				else{
					if(currentIndex < serverFileObjArray.length){
						var currentFileObj = serverFileObjArray[currentIndex];
						
						fn_egov_downFile(currentFileObj.atchFileId, currentFileObj.fileSn);
					}
				}
			}).text(updateFlag=="Y"?"파일삭제":"다운로드");
			
			spanElement2.addClass(updateFlag=="Y"?"":"btn_down2").bind("click", function(){
				var trElement = $(this).parent().parent();
				var currentIndex = Number(trElement.find("td:eq(0)").text())-1; 
				if(updateFlag == "Y"){
					if(currentIndex < serverFileObjArray.length){
						deleteFileObjArray.push(serverFileObjArray[currentIndex]);
						serverFileObjArray.splice(currentIndex, 1);
					}
					else{
						fileObjArray.splice((currentIndex-serverFileObjArray.length), 1);
					}
					
					reflashFileInfoList();
				}
				else{
					if(currentIndex < serverFileObjArray.length){
						var currentFileObj = serverFileObjArray[currentIndex];
						
						fn_cnvrFileDown(currentFileObj.atchFileId, currentFileObj.fileSn);
					}
				}
			}).text(updateFlag=="Y"?"":"미리보기");
			
		}

		for(var i=0; i<(fileNameExt.length-1); i++){
			fileName = fileName==null?fileNameExt[i]:fileName+"."+fileNameExt[i];
		}
		
		trElement.append($("<td />").text(++index)).append($("<td />").text(fileName)).append($("<td />").text(fileExt)).append($("<td />").text(fileSize+"MB")).append($("<td />").append(spanElement).append("&nbsp;").append(spanElement2));
		
*/

		tbodyElement.append(trElement);
	}

	function fn_egov_downFile(atchFileId, fileSn){
		window.open("/dggb/board/boardFile/downFile.do?atchFileId="+atchFileId+"&fileSn="+fileSn+"");
	}

	function fn_cnvrFileDown(atchFileId, fileSn){
		window.open("http://viewhosting.ssem.or.kr:8080/SynapDocViewServer/job?fid="+atchFileId+"_"+fileSn+"&filePath=https://seo2.sen.es.kr:443/dggb/cnvrFileDown.do?atchFileId="+atchFileId+":"+fileSn+"&convertType=0&fileType=URL&sync=true");
	}
	
	function fn_egov_deleteFile(atchFileId, fileSn) {
		forms = document.getElementsByTagName("form");

		for (var i = 0; i < forms.length; i++) {
			if (typeof(forms[i].atchFileId) != "undefined" &&
					typeof(forms[i].fileSn) != "undefined" &&
					typeof(forms[i].fileListCnt) != "undefined") {
				form = forms[i];
			}
		}
		
		form.atchFileId.value = atchFileId;
		form.fileSn.value = fileSn;
		
		$.ajax({
	        type:'POST'
	      , url:'/dggb/module/boardFile/deleteBoardFile.do'
	      , cache : false
	      , data:$("#boardFrm").serialize()
	      , success:function (data) {
				$("#board_area").html(data);
	      }
	      , error:function (data) {
	          alert('오류');
	      }
	      , dateType: 'html'
	 	});  
		
	}

</script>
<div id="file_div">
<input name="atchFileId" type="hidden" value="FILE_000000009422712"/>
<input name="fileSn" type="hidden"/>
<input id="fileListCnt" name="fileListCnt" type="hidden" value="1"/>
<input name="posblAtchFileNumber" type="hidden" value="2">
<!--[if !IE]>-->
<tr>
<th scope="row">파일첨부 </th>
<td colspan="3">
<table class="board_type01_intable" id="fileListTable" summary="이표는 No, 파일명, 파일형식, 파일크기, 다운로드로 구성되어 있습니다.">
<caption>파일첨부 목록</caption>
<colgroup>
<col width="5%"/>
<col width="*"/>
<col width="15%"/>
<col width="15%"/>
<col width="15%"/>
</colgroup>
<thead>
<tr>
<th scope="col">No.</th>
<th scope="col">파일명</th>
<th scope="col">파일형식</th>
<th scope="col">파일크기</th>
<th scope="col">다운로드</th>
</tr>
</thead>
<tbody></tbody>
</table>
</td>
</tr>
<!-- <![endif]-->
<!--[if lte IE 9]> 
	
	
	
		
			
			<tr>
				<th scope="row">파일첨부 1</th>
				<td colspan="3">
				
					
					
					
					
					
						 
					
						
							<a href="javascript:fn_egov_downFile('FILE_000000009422712','0')">
								중학교 입학전 예방접종 안내.pdf&nbsp;[2,221&nbsp;KB]
							</a>
							
						
						
					
					
					</div>
				</td>
			</tr>
						
		
	
	
	
	<![endif]-->
</input></div>
</tbody>
</table>
<div class="board_type01_table_bottom">
<div class="button_left">
</div>
<div class="button_right">
<button class="dark" id="list_btn" type="button">목록</button>
</div>
</div>

